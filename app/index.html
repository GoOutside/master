<!doctype html>
<html class='no-js html_user'  lang="" ng-app='goApp'>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>goOutside</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Place favicon.ico and apple-touch-icon(s) in the root directory -->
    
    <link rel="stylesheet" href="stylesheets/reset.css">
    <link rel="stylesheet" href="stylesheets/application.css">

    <!--
    <script type="text/javascript" src="js/leaflet.js"></script>
    <link rel="stylesheet" href="stylesheets/leaflet.css">

    <script type="text/javascript" src="node_modules/leaflet/src/Leaflet.js"></script>
    <link rel="stylesheet" href="node_modules/leaflet/dist/leaflet.css">

    <script src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js"></script>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5/leaflet.css" />-->

    <!--
    url(//example.com/images/some_image.png) to avoid
    -->
<!--
    <script type="text/javascript">
        console.log("Entering the script...");
        var data; 
        /*$.ajax({
          url: '/api/v1/notes4',
          async: false,
          dataType: 'json',
          success: function (response) {
            data = response; 
            console.log(data);
          }
        });
        console.log(data);*/

        var map = L.map('activity_map').setView([49, -120], 7);

        L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Tiles &copy; Esri &mdash; National Geographic, Esri, DeLorme, NAVTEQ, UNEP-WCMC, USGS, NASA, ESA, METI, NRCAN, GEBCO, NOAA, iPC',
            id: 'examples.map-20v6611k'
        }).addTo(map);

        var points = L.geoJson(data, {
            onEachFeature: function (feature, layer) {
              var popupOptions = {maxWidth: 200};
              var popupContent = feature.properties.name + "<br />" + feature.properties.lat + ", " + feature.properties.lng;
              layer.bindPopup(popupContent,popupOptions);
            }   
        });
        
        function locateUser(){
            map.locate({setView: true, maxZoom: 12}); 
        };
        map.on('locationfound', onLocationFound);
        function onLocationFound(e) {
            console.log("Found location!");
            console.log(e.latlng);
            $.get(
          "notes5",
          { paramOne : e.latlng.lat, paramTwo : e.latlng.lng},
          function(data2) {
            //alert('page content: ' + data2);
            console.log(data2);
            var hikesArray = [];
            for (var i = 0; i < data2.length; i++) {
              console.log(data2[i].geometry.coordinates);
              hikesArray.push(data2[i].geometry.coordinates[1],data2[i].geometry.coordinates[0]);
              var mark = L.marker([data2[i].geometry.coordinates[1],data2[i].geometry.coordinates[0]]).addTo(map);
              //var pointer = L.marker([ 47.63, 122.3 ]).addTo(map);

                  var popupOptions = {maxWidth: 200};
                  var popupContent =  data2[i].properties.name + "<br />" + data2[i].properties.lat + ", " +  data2[i].properties.lng;
                  mark.bindPopup(popupContent,popupOptions);
            }
            //map.setExtent(data2.getExtent());
          //var group = new L.featureGroup(data2);
          console.log(hikesArray);
          var bounds = L.latLngBounds(hikesArray);
          console.log(bounds);
          //map.fitBounds(bounds.getBounds());
          //map.fitBounds(bounds);//works!

            //map.fitBounds(data2);
          }
      );

        }
        locateUser();
        //map.addLayer(points);
    </script>-->

  </head>
  <body ng-controller="DemoController">
    <leaflet center="london" defaults="defaults" markers="markers"></leaflet>

    <div ng-view></div>
    <script src='client.js'></script>


  </body>
</html>
